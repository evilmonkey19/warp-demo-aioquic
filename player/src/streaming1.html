<!doctype html>
<html>

<head>
	<meta charset = "UTF-8">
	<title>WARP</title>

	<link rel="stylesheet" href="player.css">
	<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
</head>

<body>
	<div id="player">
		<div id="screen">
			<div id="play"><span>click to play</span></div>
			<video id="vid" controls></video>
		</div>

		<div>
			<button><a href="index.html">Go Back</a></button>
		</div>

	</div>

	<script>
		const vidRef = document.getElementById("vid")
		const playRef = document.getElementById("play")

		playRef.addEventListener('click', (e) => {
			vidRef.play()
			e.preventDefault()
			enableWT()
		})

		function playFunc(e) {
			playRef.style.display = "none"
			vidRef.removeEventListener('play', playFunc)
		}
		vidRef.addEventListener('play', playFunc)

		async function enableWT() {
			const wt = new WebTransport('https://localhost.warp.demo:4442/')
			await wt.ready
			let stream = await wt.createBidirectionalStream();
			let reader = stream.readable.getReader();
			let writer = stream.writable.getWriter();

			await writer.write(new Uint8Array([65, 66, 67]));
			let received = await reader.read();
			console.log("GUAPO");
			await wt.close();
			console.log("GUAPO");
			console.log(received);
			console.log(new TextDecoder().decode(received.value));
		}
	</script>
	<!--
	<script>
		if (Hls.isSupported()) {
		const video = document.getElementById("vid");
		var hls = new Hls();
		// bind them together
		hls.attachMedia(video);
		// MEDIA_ATTACHED event is fired by hls object once MediaSource is ready
		hls.on(Hls.Events.MEDIA_ATTACHED, function () {
			console.log('video and hls.js are now bound together !');
		});
		hls.on(Hls.Events.MANIFEST_PARSED, function (event, data) {
			console.log(
				'manifest loaded, found ' + data.levels.length + ' quality level'
			);
		});
		hls.loadSource('https://devstreaming-cdn.apple.com/videos/streaming/examples/img_bipbop_adv_example_fmp4/master.m3u8');
		hls.attachMedia(video);
		video.play();

		playRef.addEventListener('click', (e) => {
			video.play()
			e.preventDefault()
		})

		function playFunc(e) {
			playRef.style.display = "none"
			//player.goLive()

			// Only fire once to restore pause/play functionality
			video.removeEventListener('play', playFunc)
		}

		video.addEventListener('play', playFunc)
	}
		
	</script>
-->
</body>
</html>
